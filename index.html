<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Quran Track (Track your hifz/memorization)</title>
  <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js'></script> 
  <script type='text/javascript' src="http://fb.me/JSXTransformer-0.10.0.js"></script>
  <script type='text/javascript' src="http://fb.me/react-with-addons-0.10.0.js"></script>
  <script type='text/javascript' src="http://rawgit.com/inventeye/quranverse/gh-pages/js/hifzdata.js"></script>
  <script type='text/javascript' src="http://rawgit.com/inventeye/quranverse/gh-pages/js/quran.js"></script>
  <style type='text/css'>
    .Surah{border: 1px solid teal; clear: both; margin-bottom: 7px; }
	.Ayah{
		padding: 2px 2px 0px;
		text-align: center;
		border: 1px solid #808080;
		width: 25px;
		height: 18px;
		display: block;
		float: left;
		margin: 1px;
		font-size: 12px;
		text-decoration: none;
		border-radius: 3px;
	}
	.clear{ clear: both; }
	.move_right{ margin-left: 30px; }
	.arabic{ font-size: 1.4em; }
	//.Ayah{ border: 1px solid green; } //#DDDBCC

	.Ayah, div.ayah_counter a {
		padding: 2px 2px 0px;
		text-align: center;
		border: 1px solid #808080;
		width: 25px;
		height: 18px;
		display: block;
		float: left;
		margin: 1px;
		font-size: 12px;
		text-decoration: none;
		border-radius: 3px;
	}
  </style>
  
  <script type="application/javascript;version=1.7" language="JavaScript 1.7">//<![CDATA[
/** @jsx React.DOM */
// https://rawgit.com/inventeye/quranverse/gh-pages/js/hifzdata.js
// https://raw.githubusercontent.com/inventeye/quranverse/gh-pages/js/hifzdata.js

var Quran = React.createClass({
    render: function(){
        var o = {};
        o.HIFZ = this.props.data; //this is the array which has all data
		o.QURANDATA = this.props.qurandata ? this.props.qurandata : { Sura: [] };
        o.quran_length = _.chain(o.HIFZ)
                                 .map(function(item){ return item.data_surah_total; })
                                 .reduce(function(memo, num){ return parseInt(memo) + parseInt(num); }, 0)
                                 .value();
        o.juz_length   = o.quran_length / 30;
        
        return <div>                    
                    {_.range(0, this.props.data.length).map(function(s){
                       return <Surah data={this.props.data[ s ] } o={ o } qurandata={ o.QURANDATA.Sura[1 + s] } />
                    }, this)}
               </div>
    }
});

var Surah = React.createClass({
    render: function(){
        var o = this.props.o;
        var percent = function(number){
            return Math.round(  100* (parseInt(number) / o.juz_length) )/100;
        }
        return <div className="Surah ayah_counter">
                    <br/>
                    <span title={' Total length: '+ this.props.data.data_surah_total}>{this.props.data.surah_number + '. ' }</span>
					<span><b>{this.props.qurandata[5]}</b></span>
					<span className='arabic move_right'>{this.props.qurandata[4]}</span>
					<span className='move_right'><i>{this.props.qurandata[6]}</i></span>
					<span className='move_right'><b>{'( '+percent(this.props.data.data_surah_total) + ' Juz. )' }</b></span> 
                    <br/>
                    {_.range(1, 1+ this.props.data.data_ayah_lengths.length).map(function(a){
                        return <Ayah ayahno={a} alength={this.props.data.data_ayah_lengths[-1 + a]}></Ayah>
                    }, this)}
                    <div className="clear">&nbsp;</div><br/>
               </div> 
    }
});
 
var Ayah = React.createClass({
    render: function(){
        return <a className="Ayah" title={"Length: "+ this.props.alength}>{this.props.ayahno}</a>
    }
});

//React.renderComponent(<Surah data={HIFZ[113]} />, document.body);
React.renderComponent(<Quran data={HIFZ} qurandata={QuranData} />, document.body);
 
//]]> 
</script>

</head>
<body>
  <script type="text/javascript">
  (function() {
	  var tag = document.querySelector(
		'script[type="application/javascript;version=1.7"]'
	  );
	  if (!tag || tag.textContent.indexOf('window.onload=function(){') !== -1) {
		alert('Bad configuration, please inform admin.');
	  }
	  tag.setAttribute('type', 'text/jsx');
	  tag.textContent = tag.textContent.replace(/^\/\/<!\[CDATA\[/, '');
	})();
  </script>
</body>
</html>